<%= render 'lessons/nav' %>

<p id="notice"><%= notice %></p>

<main class="poettree-bg">
  <div class="poettree-ctr">
    <div class="poettree-trunk">

      <div data="poettree-poem-modal" class="leaf-branch-ctr-1 leaf-branch-ctr-left leaf-branch-ctr">
          <%= image_tag('left-branch.svg', class:'branch branch-left') %>
          <%- if @poems[0] %>
            <%= image_tag('leaves.svg', class:'leaf') %>
            <div class="poem-details-ctr">
              <p class="poettree-poem-title"> <%= truncate(@poems[0].title, length: 35) %></p>
              <p class="poettree-poem-author"><%= @poems[0].user.email.split('@')[0] %></p>
            </div>
          <% end -%>
      </div>
      <div data="poettree-poem-modal" class="leaf-branch-ctr-2 leaf-branch-ctr-right leaf-branch-ctr">
          <%= image_tag('right-branch.svg', class:'branch branch-right') %>
          <%- if @poems[1] %>
            <%= image_tag('leaves.svg', class:'leaf leaf-right') %>
             <div class="poem-details-ctr poem-details-ctr-right">
              <p class="poettree-poem-title"> <%= truncate(@poems[1].title, length: 35) %></p>
              <p class="poettree-poem-author"><%= @poems[1].user.email.split('@')[0] %></p>            
            </div>
          <% end -%>
      </div>
      <div data="poettree-poem-modal" class="leaf-branch-ctr-3 leaf-branch-ctr-left leaf-branch-ctr">
          <%= image_tag('left-branch.svg', class:'branch branch-left') %>
          <%- if @poems[2] %>
            <%= image_tag('leaves.svg', class:'leaf') %>
             <div class="poem-details-ctr">
              <p class="poettree-poem-title"> <%= truncate(@poems[2].title, length: 35) %></p>
              <p class="poettree-poem-author"><%= @poems[2].user.email.split('@')[0] %></p>            
            </div>
          <% end -%>
      </div>
      <div data="poettree-poem-modal" class="leaf-branch-ctr-4 leaf-branch-ctr-right leaf-branch-ctr">
          <%= image_tag('right-branch.svg', class:'branch branch-right') %>
          <%- if @poems[3] %>
            <%= image_tag('leaves.svg', class:'leaf leaf-right') %>
             <div class="poem-details-ctr poem-details-ctr-right">
              <p class="poettree-poem-title"> <%= truncate(@poems[3].title, length: 35) %></p>
              <p class="poettree-poem-author"><%= @poems[3].user.email.split('@')[0] %></p>            
            </div>
          <% end -%>
      </div>      
      <div data="poettree-poem-modal" class="leaf-branch-ctr-5 leaf-branch-ctr-left leaf-branch-ctr">
          <%= image_tag('left-branch.svg', class:'branch branch-left') %>
          <%- if @poems[4] %>
            <%= image_tag('leaves.svg', class:'leaf') %>
             <div class="poem-details-ctr">
              <p class="poettree-poem-title"> <%= truncate(@poems[4].title, length: 35) %></p>
              <p class="poettree-poem-author"><%= @poems[4].user.email.split('@')[0] %></p>            
            </div>
          <% end -%>
      </div>
      <div class="poettree-hole"></div>
      
    </div>
  </div>

  <%= link_to_next_page @poems, 'Next Page' %>
  <%= link_to_previous_page @poems, 'Last Page' %>

  <div data="poettree-search-modal" id="search" class="poettree-icon-btn poettree-search-btn" title="Search for Poems">
    <%= image_tag('search-icon.svg', class:'poettree-search-icon') %>
  </div>
  <div data="poettree-info-modal" id="info" class="poettree-icon-btn poettree-info-btn" title="Information About This Page">
    <p>?</p>
  </div>
  <a data="poettree-my-poems-btn" href="/poettree/my_poems" id="myPoems" class="poettree-icon-btn poettree-my-poems-btn" title="All of Your Poems">
    <%= image_tag('my-poems-icon.svg', class:'poettree-my-poems-icon') %>
  </a>


</main>
<div class="poettree-search-modal hidden">
  <h2>Search for Poems</h2>
  
    <%= form_for poems_path, method: :get, html: { class: "poettree-search-bar" } do |f| %>
  
      <%= text_field_tag :search, params[:search], class: 'poettree-search-bar-input' %>
      <%= f.submit 'Search', class: 'poettree-search-bar-btn' %>

  
    <% end %>
  
   
</div>
<div class="poettree-info-modal hidden">
  <h2>Welcome to the Poettree</h2>
  <p>Here you can find any poems that other students have decided to post to the PoetTree. You can search for poems by clicking the search icon in the top right corner. You can also see all of your poems by clicking the little person icon in the bottom right corner. Have fun and check out what your friends have added to the PoetTree!</p>
</div>
<div class="poettree-poem-modal hidden">
  <h2 class="poettree-poem-modal-title">All the Kings Men</h2>
  <span class="poettree-poem-modal-author">by Ms Poetry Master</span> 
  <p class="poettree-poem-modal-body">
        Do not go gentle into that good night,
    Old age should burn and rave at close of day;
    Rage, rage against the dying of the light.
    
    Though wise men at their end know dark is right,
    Because their words had forked no lightning they
    Do not go gentle into that good night.
    
    Good men, the last wave by, crying how bright
    Their frail deeds might have danced in a green bay,
    Rage, rage against the dying of the light.
    
    Wild men who caught and sang the sun in flight,
    And learn, too late, they grieved it on its way,
    Do not go gentle into that good night.
    
    Grave men, near death, who see with blinding sight
    Blind eyes could blaze like meteors and be gay,
    Rage, rage against the dying of the light.
    
    And you, my father, there on the sad height,
    Curse, bless, me now with your fierce tears, I pray.
    Do not go gentle into that good night.
    Rage, rage against the dying of the light.
  </p>
  <div class="poettree-poem-modal-icon poettree-poem-modal-icon-active">
    <%= image_tag('preview-poem-icon.svg', class: "poettree-preview-poem-icon") %>
  </div>
  <div class="poettree-poem-modal-icon poettree-poem-modal-icon-inactive">
    <%= image_tag('preview-img-icon.svg', class: "poettree-preview-img-icon") %>
  </div>
</div>

<script>
  $(document).ready(function() {
    
	// Find Elements
	const body = document.querySelector("body")
  const search = document.getElementById("search")
  const info = document.getElementById("info")
  const myPoems = document.getElementById("myPoems")
  const searchModal = document.querySelector(".poettree-search-modal")
  const infoModal = document.querySelector(".poettree-info-modal")
  const poemModal = document.querySelector(".poettree-poem-modal")
  const btns = [search, info]
  const branches = Array.from(document.querySelectorAll(".leaf-branch-ctr"))
	// Create & Mutate Elements
	const overlay = document.createElement("div")
	overlay.setAttribute("data", "")
	overlay.className = "hidden overlay"
	overlay.style.zIndex = "2"

	//Add Elements to Page
	body.appendChild(overlay)

	// Event Functions


	const overlayToggle = () => {
		overlay.classList.toggle("hidden")
	}
	
	const modalOverlayToggle = () => {
		overlay.classList.toggle("hidden")
		modal.innerHTML = ""
		modal.classList.toggle("hidden")
	}
	
	const searchModalToggle = (e) => {
	  if(overlay.getAttribute("data") == ""){
  	  overlay.setAttribute("data", e.target.getAttribute("data"))
	  }
    searchModal.classList.toggle("hidden")
	}
	const infoModalToggle = (e) => {
	  if(overlay.getAttribute("data") == ""){
  	  overlay.setAttribute("data", e.target.getAttribute("data"))
	  }
    infoModal.classList.toggle("hidden")
	}
	const poemModalToggle = (e) => {
	  if(overlay.getAttribute("data") == ""){
	    console.log(e.target)
  	  overlay.setAttribute("data", e.target.getAttribute("data"))
	  }
    poemModal.classList.toggle("hidden")
	}
	
	const modalToggle = (type) => {
	  if(type === "poettree-info-modal") {
	    infoModalToggle()
	  }
	  else if(type === "poettree-search-modal") {
	    searchModalToggle()
	  }
	  else if(type === "poettree-poem-modal" ){
	    poemModalToggle()
	  }
	}
	//Attach Events
	btns.map((ele) => {
	  ele.addEventListener("click", overlayToggle)
	})
	branches.map((ele) => {
  	ele.addEventListener("click", overlayToggle)
	  ele.addEventListener("click", poemModalToggle)
	})
	
	search.addEventListener("click", searchModalToggle)
	info.addEventListener("click", infoModalToggle)
	
	overlay.addEventListener("click", (e) => {
		const modalType = e.target.getAttribute("data")
		modalToggle(modalType)
		overlayToggle()
		overlay.setAttribute("data", "")
	})
})
</script>